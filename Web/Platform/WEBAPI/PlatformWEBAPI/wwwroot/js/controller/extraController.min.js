function BindExtraTop(t,e){var a=sessionStorage.getItem("properties");if(null==a){var n=R.Extra.culture+"/Extra/GetPropertyDetails";$.post(n,null,function(a){sessionStorage.setItem("properties",a);var n=JSON.parse(a),i=!1,o=!1;null!=n.length&&n.forEach(function(a){null!=e&&e.find(function(e){if(parseInt(e)==a.Id&&"top"==a.Position&&($(t).find(".tag-1").html(a.Name),$(t).find(".tag").html(a.Name),i=!0),parseInt(e)==a.Id&&"bottom"==a.Position){var n=R.StoreFilePath(!0)+a.Thumb;$(t).find(".tag-2-thumb").attr("src",n),o=!0}})}),0==i&&$(t).find(".tag-1").hide()})}else{var i=JSON.parse(a),o=!1,r=!1;console.log(i),null!=i.length&&i.forEach(function(a){null!=e&&e.find(function(e){if(parseInt(e)==a.Id&&"top"==a.Position&&($(t).find(".tag-1").html(a.Name),$(t).find(".tag").html(a.Name),o=!0,console.log($(t))),parseInt(e)==a.Id&&"bottom"==a.Position){var n=R.StoreFilePath(!0)+a.Thumb;$(t).find(".tag-2-thumb").attr("src",n),r=!0}})}),0==o&&($(t).find(".tag-1").hide(),$(t).find(".tag").hide())}}function readURL(t,e){if(t.files&&t.files[0]){var a=new FileReader;a.onload=function(t){e.find("._binding_pickup_img").show(),e.find("._place-img").attr("src",t.target.result).css("max-width","300").css("max-height","200"),R.Extra.RegisterEvent()},a.readAsDataURL(t.files[0])}}R.Extra={Init:function(){R.Extra.RegisterEvent(),R.Extra.culture=R.Culture(),R.Extra.GetPropertyDetails(),R.Extra.BindingExtraToProduct(),R.Extra.GenerateAvatarCircle(),R.Extra.CommentPaging(),R.Extra.Url="http://cms.janhome.com.vn"},RegisterEvent:function(){$("#comment-form").off("submit").on("submit",function(){var t=$(this).data("type"),e=$(this).data("object-id"),a=$(this).data("object-type"),n=$(this).find(".txt_name").val(),i=$(this).find(".txt_phoneOrEmail").val(),o=$(this).find(".input-choose-file").data("target-url"),r=$(this).find(".txt_content").val(),s=$(this).find(".input-choose-file").get(0).files,l={objectId:e,objectType:a,name:n,phoneOrEmail:i,avatar:o,content:r,type:t,rate:0};return R.Extra.CreateComment(s,l),!1}),$(".star-rating i").off("click").on("click",function(){$(this).parent().find(".star-rating i").removeClass("checked"),$(this).addClass("checked"),$(this).prevAll().addClass("checked"),$(this).nextAll().removeClass("checked");var t=$(this).closest(".star-rating").data("type"),e=$(this).closest(".star-rating").data("id"),a=$(this).parent();R.Extra.Rating(a,e,t)}),$(".reply_comment").off("click").on("click",function(){var t=$(this),e=$(this).closest(".comment_infomation").data("id"),a=$(this).closest(".comment_infomation").data("object-id"),n=$(this).closest(".comment_infomation").data("object-type");$("._comment_reply").each(function(t){$(this).html("")}),R.Extra.RenderReplyComment(t,e,a,n)}),$(".send-comment-reply").off("click").on("click",function(){var t=$(this).data("parent"),e=$(this).data("object-id"),a=$(this).data("object-type"),n=$(this).data("type"),i=($(this).data("lang"),$(this).closest(".reply").find(".txt_name").val()),o=$(this).closest(".reply").find(".txt_phoneOrEmail").val(),r=$(this).closest(".reply").find(".input-choose-file").data("target-url"),s=$(this).closest(".reply").find(".txt_content").val(),l=$(this).closest(".reply").find(".input-choose-file").get(0).files,c={objectId:e,objectType:a,name:i,phoneOrEmail:o,avatar:r,content:s,type:n,rate:0,parentId:t};R.Extra.CreateComment(l,c)}),$(".input-choose-file").off("change").on("change",function(){readURL(this,$(this).closest(".upload-parent"))}),$("._place-img-close").off("click").on("click",function(){$(this).parent().parent().find("._place-img").attr("src",""),$(this).parent().parent().hide(),$(".input-choose-file").val("")})},GetPropertyDetails:function(){if(null==sessionStorage.getItem("properties")){var t=R.Extra.culture+"/Extra/GetPropertyDetails";$.post(t,null,function(t){sessionStorage.setItem("properties",t)})}},BindingExtraToProduct:function(){$(".item-product").each(function(t){var e=$(this).data("properties");if(void 0!==e&&""!=e){var a=e.toString();$(this);if(""!=a){var n=a.split(",");BindExtraTop($(this),n)}}else $(this).find(".tag-1").hide()}),$(".product-detail").each(function(t){var e=$(this).data("properties");if(console.log(e,typeof e),void 0!==e&&""!=e){var a=e.toString();$(this);if(""!=a){var n=a.split(",");BindExtraTop($(this),n)}}else $(this).find(".tag").hide()})},BindingExtraToProductInElement:function(t){$(t).find(".item-product").each(function(t){var e=$(this).data("properties");if(void 0!==e){var a=[];(!e||"string"==typeof e&&1==e.includes(","))&&(a=e.split(",")),(!e||"string"==typeof e&&0==e.includes(",")&&null!=e)&&a.push(e),BindExtraTop($(this),a)}})},CreateComment:function(t,e){if(console.log(t),console.log(e),null!=t){for(var a=new FormData,n=0;n<t.length;n++)a.append(t[n].name,t[n]);$.ajax({url:R.Extra.Url+"/api/UploadFile/UploadImage",type:"POST",data:a,contentType:!1,processData:!1,success:function(t){console.log(t),e.avatar=t.linkImage;var a=R.Extra.culture+"/Extra/CreateComment";$.post(a,e,function(t){return $("#modal-xn").modal("show"),R.Extra.CloseModalAndClearText(),!1})},error:function(t){alert(t.statusText)}})}else{var i=R.Extra.culture+"/Extra/CreateComment";$.post(i,e,function(t){return $("#modal-xn").modal("show"),R.Extra.CloseModalAndClearText(),!1})}},CloseModalAndClearText:function(){$(".txt_name").val(""),$(".txt_phoneOrEmail").val(""),$(".txt_content").val(""),$(".modal-danh-gia").modal(hide),$("._comment_reply").each(function(t){$(this).html("")})},Rating:function(t,e,a){var n=0;t.find(".checked").each(function(t){n++});var i=R.Extra.culture+"/Extra/CreateRating",o={objectId:e,objectType:a,rate:n};$.post(i,o,function(e){console.log("khoi tao rate "+e),console.log(t),t.find("i").off("click")})},GenerateAvatarCircle:function(){$(".avatar").each(function(t){var e=$(this).data("name");if(console.log(e,typeof e),null!=e&&e.indexOf(" ")>-1){var a=e.split(" "),n="",i="";n=a[0].charAt(0),a.length>=2&&(i=a[1].charAt(0));$(this).text(n+" "+i)}else n=e.charAt(0),$(this).text(n)})},RenderReplyComment:function(t,e,a,n){var i=R.Extra.culture+"/Extra/GetReplyComment",o={id:e,obj_id:a,obj_type:n};$.post(i,o,function(e){t.closest(".media-body").find("._comment_reply").first().html("").html(e),R.Extra.RegisterEvent()})},CommentPaging:function(){if($(".comment-paging").length>0){for(var t=parseInt($(".comment-paging").data("total")),e=parseInt($(".comment-paging").data("size")),a=parseInt($(".comment-paging").data("object-id")),n=parseInt($(".comment-paging").data("object-type")),i=[],o=0;o<t;o++)i.push(o);$(".comment-paging").pagination({dataSource:i,pageSize:e,showPrevious:!1,showNext:!1,callback:function(t,e){console.log(e.pageNumber);var i=e.pageNumber,o=R.Extra.culture+"/Extra/GetCommentList",r={object_id:a,object_type:n,pageIndex:i};$.post(o,r,function(t){$(".comment_binding").html("").html(t),R.Extra.GenerateAvatarCircle(),R.Extra.RegisterEvent()})}})}}},$(function(){R.Extra.Init()});