R.Estimates={Init:function(){R.Estimates.location_id=R.CurrentLocationId(),R.Estimates.culture=R.Culture(),R.Estimates.RegisterEvent(),R.Estimates.RenderEstimatesItemFromLocal(),R.Estimates.default_loading_page=1,R.Estimates.SortByPrice=0},RegisterEvent:function(){$(".infomation-room input").off("focusout").on("focusout",function(){R.Estimates.CalculateSpaceRoom(),R.Estimates.CalculateQuantityInItemChoose()}),$(".choose-material-type").off("click").on("click",function(){var t=$(this).data("material-type");R.Estimates.BindingMaterialModel(t)}),$(".list-filter-modal .heading").click(function(){$(this).closest(".menu.sub").toggleClass("show")}),$(".spectification-value").off("click").on("click",function(){$(this).hasClass("active")?$(this).removeClass("active"):($(this).parent().find(".spectification-value").removeClass("active"),$(this).addClass("active")),R.Estimates.ChooseSpectificationValue()}),$(".product-pick-item").off("click").on("click",function(){var t=$(".list-filter-modal").data("material-type"),e={Id:$(this).data("id"),Title:$(this).data("title"),SalePrice:$(this).data("sale-price"),Price:$(this).data("price"),MaterialType:t,Avatar:$(this).data("avatar"),SpecName:$(this).data("spec-name"),SpecValue:$(this).data("spec-value")};console.log(e),R.Estimates.PickingEstimatesItem(e)}),$(".item-selected-edit-button").off("click").on("click",function(){var t=$(this).closest(".item-choose").data("material-type");R.Estimates.BindingMaterialModel(t)}),$(".item-selected-del-button").off("click").on("click",function(){var t=$(this).closest(".item-choose").data("material-type");$(this).closest(".item-choose").find(".material-item-selected").data("is-rendered",!1),$(this).closest(".item-choose").find(".material-item-selected").hide(),$(this).closest(".item-choose").find(".btn-choose").show();var e=null==$("#acreage").val()?0:$("#acreage").val(),a=null==$("#perimeter").val()?0:$("#perimeter").val(),i=localStorage.getItem("arrEstimates");if(null!=i){for(var l=JSON.parse(i),o=0;o<l.length;o++)l[o].MaterialType==t&&l.splice(o,1);localStorage.setItem("arrEstimates",JSON.stringify(l))}R.Estimates.FillValueToCalculatedCard(e,a)}),$(".item-selected-minus-button").off("click").on("click",function(){var t=$(this).closest(".item-choose").data("unit"),e=$(this).closest(".material-item-selected").data("sale-price");if("m"==t||"m2"==t){a=parseFloat($(this).closest(".item-choose").find(".item-selected-quantity").val());a-=.1,$(this).closest(".item-choose").find(".item-selected-quantity").val(a.toFixed(1))}else{var a=parseFloat($(this).closest(".item-choose").find(".item-selected-quantity").val());a-=1,$(this).closest(".item-choose").find(".item-selected-quantity").val(a.toFixed(1))}var i=null==$("#acreage").val()?0:$("#acreage").val(),l=null==$("#perimeter").val()?0:$("#perimeter").val();console.log(i,l),R.Estimates.CalculateTotalInItemChoose($(this),e),R.Estimates.FillValueToCalculatedCard(i,l)}),$(".item-selected-plus-button").off("click").on("click",function(){console.log("minus");var t=$(this).closest(".item-choose").data("unit"),e=$(this).closest(".material-item-selected").data("sale-price");if("m"==t||"m2"==t){a=parseFloat($(this).closest(".item-choose").find(".item-selected-quantity").val());a+=.1,$(this).closest(".item-choose").find(".item-selected-quantity").val(a.toFixed(1))}else{var a=parseFloat($(this).closest(".item-choose").find(".item-selected-quantity").val());a+=1,$(this).closest(".item-choose").find(".item-selected-quantity").val(a.toFixed(1))}var i=""==$("#acreage").val()?0:$("#acreage").val(),l=""==$("#perimeter").val()?0:$("#perimeter").val();console.log(i,l),R.Estimates.CalculateTotalInItemChoose($(this),e),R.Estimates.FillValueToCalculatedCard(i,l)}),$(".contruction-estimates-form").off("submit").on("submit",function(){var t=$(this).find(".tinh-thanh option:selected").html(),e=$(this).find(".quan-huyen option:selected").html(),a=$(this).find(".phuong-xa option:selected").html(),i=$(this).find(".so-nha").val()+" - "+a+" - "+e+" - "+t,l={Gender:$("input[name='gender-radio']:checked").val(),Name:$(this).find(".name").val(),PhoneNumber:$(this).find(".phone-number").val(),Note:$(this).find(".note").val(),Address:i,Id:0},o=[];$(this).find(".extra-infomation").each(function(t){$(this).is(":checked")&&o.push($(this).data("content"))});var s=[];return $(".material-item-selected").each(function(t){var e=$(this);if(1==e.data("is-rendered")){var a={ProductId:e.data("id"),Name:e.data("name"),LogPrice:e.data("sale-price"),Quantity:parseFloat(e.find(".item-selected-quantity").val()),Promotions:[]};s.push(a)}}),console.log(l),console.log(o),console.log(s),R.Estimates.RenderModalConfirmOrder(l,o,s),!1}),$(".tinh-thanh").off("change").on("change",function(){var t=$(this).val();R.Estimates.PickingProvince("quan_huyen",t)}),$(".quan-huyen").off("change").on("change",function(){var t=$(this).val();R.Estimates.PickingProvince("phuong_xa",t)}),$(".list-product-modal-2").unbind("scroll").bind("scroll",function(){console.log("scrool vao day"),$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight-20&&(R.Estimates.default_loading_page=R.Estimates.default_loading_page+1,R.Estimates.ChooseSpectificationValuePaging(R.Estimates.default_loading_page))}),$(".filter-text").off("focusout").on("focusout",function(){R.Estimates.ChooseSpectificationValue()}),$("._sort_price").off("click").on("click",function(){return 0==R.Estimates.SortByPrice?(R.Estimates.SortByPrice=R.Estimates.SortByPrice+1,R.Estimates.ChooseSpectificationValue(),null):1==R.Estimates.SortByPrice?(R.Estimates.SortByPrice=R.Estimates.SortByPrice-1,R.Estimates.ChooseSpectificationValue(),null):void console.log(R.Estimates.SortByPrice)})},BindingMaterialModel:function(t){var e=R.Estimates.culture+"/Estimates/GetSpectificationMenuByMaterialType",a={material_type:t};$.post(e,a,function(t){$("#material-model").find(".modal-content").html("").html(t),$("#material-model").modal("show"),R.Estimates.RegisterEvent()}),R.Estimates.RegisterEvent()},ChooseSpectificationValuePaging:function(t){var e=$(".list-filter-modal").data("material-type"),a=[];$(".list-filter-modal").find(".spectification-value").each(function(t){if($(this).hasClass("active")){var e={SpectificationId:$(this).data("spectification-id"),Value:$(this).data("spectification-value")};a.push(e)}});var i=R.Estimates.location_id,l=$(".filter-text").val(),o=t,s={parentId:0,lang_code:"vi-VN",locationId:i,manufacture_id:0,min_price:0,max_price:0,sort_price:R.Estimates.SortByPrice,sort_rate:0,color_code:"",filter:a,filter_text:l,material_type:e,pageNumber:o,pageSize:10},r=R.Estimates.culture+"/Estimates/GetProductInSpectificationSearch";$.post(r,s,function(t){$(".list-product-modal-2").append(t),R.Estimates.default_loading_page=R.Estimates.default_loading_page+1,R.Estimates.RegisterEvent()}),R.Estimates.RegisterEvent()},ChooseSpectificationValue:function(){var t=$(".list-filter-modal").data("material-type"),e=[];$(".list-filter-modal").find(".spectification-value").each(function(t){if($(this).hasClass("active")){var a={SpectificationId:$(this).data("spectification-id"),Value:$(this).data("spectification-value")};e.push(a)}});var a=R.Estimates.location_id,i=R.Estimates.SortByPrice,l=$(".filter-text").val(),o={parentId:0,lang_code:"vi-VN",locationId:a,manufacture_id:0,min_price:0,max_price:0,sort_price:i,sort_rate:0,color_code:"",filter:e,filter_text:l,material_type:t,pageNumber:1,pageSize:10},s=R.Estimates.culture+"/Estimates/GetProductInSpectificationSearch";$.post(s,o,function(t){$(".list-product-modal-2").html("").html(t),R.Estimates.default_loading_page=2,R.Estimates.RegisterEvent()}),R.Estimates.RegisterEvent()},PickingEstimatesItem:function(t){var e=localStorage.getItem("arrEstimates");if(null==e){(a=[]).push(t),localStorage.setItem("arrEstimates",JSON.stringify(a))}if(null!=e){for(var a=JSON.parse(e),i=!1,l=0;l<a.length;l++)a[l].MaterialType==t.MaterialType&&(a.splice(l,1),a.push(t),i=!0);0==i&&a.push(t),localStorage.setItem("arrEstimates",JSON.stringify(a))}var o=parseFloat(parseFloat(null==$("#length").val()?0:$("#length").val()).toFixed(1)),s=parseFloat(parseFloat(null==$("#width").val()?0:$("#width").val()).toFixed(1)),r=parseFloat(parseFloat(null==$("#count-door").val()?0:$("#count-door").val()).toFixed(1)),n=parseFloat(parseFloat(null==$("#length-door").val()?0:$("#length-door").val()).toFixed(1));acreage=o*s;var c=2*(o+s)-n*r;acreage=parseFloat(acreage.toFixed(1)),c=parseFloat(c.toFixed(1)),$(".item-choose").each(function(e){if($(this).find(".btn-choose").data("material-type")==t.MaterialType){$(this).find(".btn-choose").hide(),$(this).find(".material-item-selected").hide().show(),$(this).find(".material-item-selected").data("id",t.Id),$(this).find(".material-item-selected").data("name",t.Title),$(this).find(".material-item-selected").data("sale-price",t.SalePrice<=0||t.SalePrice==t.Price?t.Price:t.SalePrice),$(this).find(".material-item-selected").data("is-rendered",!0),$(this).find(".material-item-selected .item-selected-avatar").attr("src","").attr("src",t.Avatar),$(this).find(".material-item-selected .item-selected-title").text("").text(t.Title),$(this).find(".material-item-selected .item-selected-spec-name").text("").text(t.SpecName),$(this).find(".material-item-selected .item-selected-spec-value").text("").text(t.SpecValue);var a=0;"m2"==$(this).data("unit")&&($(this).find(".material-item-selected .item-selected-quantity").val(acreage),a=acreage*t.SalePrice),"m"==$(this).data("unit")&&($(this).find(".material-item-selected .item-selected-quantity").val(c),a=c*t.SalePrice);var i=a.toFixed(0);$(this).find(".material-item-selected .item-selected-sale-price").text("").text(R.FormatNumber(i)+" đ"),$(this).find(".material-item-selected").data("sale-price",t.SalePrice)}}),$("#material-model").modal("hide"),R.Estimates.CheckedLabor(acreage),R.Estimates.FillValueToCalculatedCard(acreage,c),R.Estimates.RegisterEvent()},CalculateSpaceRoom:function(){var t=0,e=parseFloat(parseFloat(null==$("#length").val()?0:$("#length").val()).toFixed(1)),a=parseFloat(parseFloat(null==$("#width").val()?0:$("#width").val()).toFixed(1)),i=parseFloat(parseFloat(null==$("#count-door").val()?0:$("#count-door").val()).toFixed(1));t=e*a;var l=parseFloat(parseFloat(null==$("#length-door").val()?0:$("#length-door").val()).toFixed(1))*i,o=2*(e+a)-l;console.log(1),t=parseFloat(t.toFixed(1)),o=parseFloat(o.toFixed(1)),$("#acreage").val(t),$("#perimeter").val(o),$(".room-acreage-woodfloor").text(t),$(".room-acreage-woodfloor").data("value",t),$(".room-acreage-styrofoam").text(t),$(".room-acreage-styrofoam").data("value",t),$(".room-length-splint").text(l),$(".room-length-splint").data("value",l),$(".room-length-walling").text(o),$(".room-length-walling").data("value",o),R.Estimates.CheckedLabor(t),R.Estimates.FillValueToCalculatedCard(t,o),R.Estimates.RegisterEvent()},CalculateQuantityInItemChoose:function(){var t=parseFloat(parseFloat(null==$("#length").val()?0:$("#length").val()).toFixed(1)),e=parseFloat(parseFloat(null==$("#width").val()?0:$("#width").val()).toFixed(1)),a=parseFloat(parseFloat(null==$("#count-door").val()?0:$("#count-door").val()).toFixed(1)),i=parseFloat(parseFloat(null==$("#length-door").val()?0:$("#length-door").val()).toFixed(1));acreage=t*e;var l=i*a,o=2*(t+e)-l;acreage=parseFloat(acreage.toFixed(1)),o=parseFloat(o.toFixed(1)),$(".item-choose").each(function(t){var e=$(this).find(".material-item-selected").data("sale-price"),a=$(this).find(".item-selected-plus-button");"m2"==$(this).data("unit")&&($(this).find(".material-item-selected .item-selected-quantity").val(acreage),R.Estimates.CalculateTotalInItemChoose(a,e)),"m"==$(this).data("unit")&&($(this).find(".material-item-selected .item-selected-quantity").val(o),R.Estimates.CalculateTotalInItemChoose(a,e)),"m-door"==$(this).data("unit")&&($(this).find(".material-item-selected .item-selected-quantity").val(l),R.Estimates.CalculateTotalInItemChoose(a,e)),"box"==$(this).data("unit")&&($(this).find(".material-item-selected .item-selected-quantity").val(1),R.Estimates.CalculateTotalInItemChoose(a,e))})},CheckedLabor:function(t){$(".labor").each(function(e){var a=parseFloat($(this).data("min-area")),i=parseFloat($(this).data("max-area"));t>=a&&t<=i&&($(".labor").prop("checked",!1),$(this).prop("checked",!0))}),R.Estimates.RegisterEvent()},FillValueToCalculatedCard:function(t,e){console.log(t,e);var a=0,i=0;$(".item-choose").each(function(t){var e=""==$(this).find(".item-selected-quantity").val()?0:$(this).find(".item-selected-quantity").val(),i=parseFloat(e);console.log(e,typeof e),a+=$(this).find(".material-item-selected").data("sale-price")*i}),$(".labor").each(function(e){$(this).is(":checked")&&0==$(this).data("is-per-metter")&&(i=$(this).data("item-price")),$(this).is(":checked")&&1==$(this).data("is-per-metter")&&(i=parseInt($(this).data("item-price"))*t)});var l=parseInt(a)+parseInt(i);$(".caled-acreage").text(t),$(".caled-acreage").data("value",t),$(".caled-labor").text(R.FormatNumber(parseInt(i))+"đ"),$(".caled-labor").data("value",parseInt(i)),$(".caled-material").text(R.FormatNumber(parseInt(a))),$(".caled-material").data("value",parseInt(a)),$(".caled-total").text(R.FormatNumber(l)),$(".caled-total").data("value",l),R.Estimates.RegisterEvent()},CalculateTotalInItemChoose:function(t,e){var a=t.closest(".material-item-selected").find(".item-selected-quantity").val(),i=parseInt(parseFloat(e)*parseFloat(a));t.closest(".material-item-selected").find(".item-selected-sale-price").text("").text(R.FormatNumber(i)+" đ")},RenderModalConfirmOrder:function(t,e,a){event.preventDefault();var i=$("#modal-don-hang");i.find(".table-report-item-append").each(function(t){$(this).remove()}),i.find(".customer-name").text(t.Name),i.find(".customer-phone").text(t.PhoneNumber),i.find(".customer-address").text(t.Address);var l="";return e.forEach(function(t){l+="<li>"+t+"</li>"}),i.find(".list_extra_infomation").empty().append(l),a.forEach(function(t){console.log(t.Quantity,typeof t.Quantity),$(".table-report-item").last().clone().insertAfter(".table-report-item:last");var e=$(".table-report-item").last();e.find(".product-id").text(t.ProductId),e.find(".product-name").text(t.Name),e.find(".product-quantity").text(t.Quantity),e.find(".product-price").text(R.FormatNumber(t.LogPrice));var a=t.LogPrice*t.Quantity;e.find(".product-total-price").text(R.FormatNumber(parseInt(a)));var i="";t.Promotions.forEach(function(t){i+="<li>"+t.LogName+"</li>"}),e.find(".product-promotion-ul").empty().append(i),e.css("display","table-row"),e.addClass("table-report-item-append")}),i.find(".total-payment").html(R.FormatNumber($(".caled-total").data("value"))+"vnd"),$("#modal-don-hang").modal("show"),i.find(".btn-save").off("click").on("click",function(){var i={OrderCode:"random.org - 1",Customer:t,Products:a,Extras:e},l={order:JSON.stringify(i)},o=R.Order.culture+"/Order/CreateOrderStringtify";$.post(o,l,function(t){alert(t)})}),!1},PickingProvince:function(t,e){var a="."+t.replace("_","-"),i={locationType:t,parent:e};$.post("/Order/GetQuanHuyen",i,function(t){var e=JSON.parse(t);console.log(e),console.log(a),$(a).prop("disabled",!1);var i="";e.forEach(function(t){i+='<option value="'+t.Key+'">'+t.Value.name_with_type+"</option>"}),$(a).html("").html(i)})},RenderEstimatesItemFromLocal:function(){var t=localStorage.getItem("arrEstimates");if(console.log(t),null!=t){JSON.parse(t).forEach(function(t){R.Estimates.PickingEstimatesItem(t)})}},ReplaceEstimatesFromLocal:function(){}},$(function(){R.Estimates.Init()});