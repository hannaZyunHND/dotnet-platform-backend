R.Order={Init:function(){R.Order.culture=R.Culture(),R.Order.LoadOrderDetail(),R.Order.RegisterEvent()},RegisterEvent:function(){$(".plus").off("click").on("click",function(){var t=$(this).closest(".item").data("id"),e=$(this).parent().find(".quantity").val();$(this).parent().find(".quantity").val(parseInt(e)+1);var r=$(this).closest(".item"),a=JSON.parse(localStorage.getItem("arrProduct"));a.find(function(r){r.product_id==t&&(r.quantity=parseInt(e)+1)}),localStorage.setItem("arrProduct",JSON.stringify(a)),R.LoadCart(),R.Order.CalculatePriceProductItem(r)}),$(".minus").off("click").on("click",function(){var t=$(this).closest(".item").data("id"),e=$(this).parent().find(".quantity").val();$(this).parent().find(".quantity").val(parseInt(e)-1);var r=$(this).closest(".item"),a=JSON.parse(localStorage.getItem("arrProduct"));a.find(function(r){r.product_id==t&&(r.quantity=parseInt(e)-1)}),localStorage.setItem("arrProduct",JSON.stringify(a)),R.LoadCart(),R.Order.CalculatePriceProductItem(r)}),$(".choose-promotion").off("change").on("change",function(){var t="#item-"+$(this).closest(".item-promotion").data("product-id"),e=$(t);R.Order.CalculatePriceProductItem(e)}),$("#link-clear-cart").off("click").on("click",function(){R.ClearCart(),R.LoadCart()}),$(".remove-cart-item").off("click").on("click",function(){var t=$(this).closest(".item").data("id");$(this).closest(".item").remove(),R.RemoveCartItem(t),R.Order.CalculateTotalOrders(),R.LoadCart()}),$(".choosen-item").off("change").on("change",function(){R.Order.CalculateTotalOrders()}),$("#order-form").off("submit").on("submit",function(){var t=$(this).find(".tinh-thanh option:selected").html(),e=$(this).find(".quan-huyen option:selected").html(),r=$(this).find(".phuong-xa option:selected").html(),a=$(this).find(".so-nha").val()+" - "+r+" - "+e+" - "+t,o={Gender:$("input[name='gender-radio']:checked").val(),Name:$(this).find(".name").val(),PhoneNumber:$(this).find(".phone-number").val(),Note:$(this).find(".note").val(),Address:a,Id:0},n=[];$(this).find(".extra-infomation").each(function(t){$(this).is(":checked")&&n.push($(this).data("content"))});var i=[];return $(".item").each(function(t){var e=$(this);if(e.find(".choosen-item").is(":checked")){var r=[];e.find(".choose-promotion").each(function(t){if($(this).is(":checked")){var e={PromotionId:$(this).data("id"),LogType:$(this).data("type"),LogValue:$(this).data("value"),LogName:$(this).data("name")};r.push(e)}});var a=1,o=0;e.data("is-flash-sale")>0&&(a=3,o=e.data("is-flash-sale"));var n={ProductId:e.data("id"),Name:e.data("name"),LogPrice:e.data("sale-price"),Quantity:parseInt(e.find(".quantity").val()),OrderSourceType:a,OrderSourceId:o,Promotions:r};i.push(n)}}),console.log(o),console.log(n),console.log(i),R.Order.RenderModalConfirmOrder(o,n,i),!1}),$(".tinh-thanh").off("change").on("change",function(){var t=$(this).val();R.Order.PickingProvince("quan_huyen",t)}),$(".quan-huyen").off("change").on("change",function(){var t=$(this).val();R.Order.PickingProvince("phuong_xa",t)}),$(".cbx-affectedd-all").off("change").on("change",function(){1==$(this).is(":checked")?R.Order.CheckAllCheckbox():R.Order.UnCheckAllCheckbox()}),$(".quantity").off("focusout").on("focusout",function(){var t=$(this).closest(".item").data("id"),e=$(this).val(),r=$(this).closest(".item"),a=JSON.parse(localStorage.getItem("arrProduct"));a.find(function(r){r.product_id==t&&(r.quantity=parseInt(e))}),localStorage.setItem("arrProduct",JSON.stringify(a)),R.LoadCart(),R.Order.CalculatePriceProductItem(r)})},CheckAllCheckbox:function(){$(".choosen-item").each(function(t){$(this).prop("checked",!0)})},UnCheckAllCheckbox:function(){$(".choosen-item").each(function(t){$(this).prop("checked",!1)})},LoadOrderDetail:function(){JSON.parse(localStorage.getItem("arrProduct"));var t={product_ids:$("#link-target-cart").data("product_ids")};$.post(R.Order.culture+"/Order/LoadOrderDetail",t,function(t){$("._binding_order").html("").html(t),R.Order.CheckAllCheckbox(),R.Order.OrderDetailInLocalStorage()})},OrderDetailInLocalStorage:function(){JSON.parse(localStorage.getItem("arrProduct")).forEach(function(t){var e="#item-"+t.product_id;$(e).find(".quantity").val(t.quantity);var r=parseInt($(e).find(".price-new").data("sale-price"));$(e).find(".item-sum").text(R.FormatNumber(parseInt(t.quantity)*r)),R.Order.CalculatePriceProductItem($(e))}),R.Order.RegisterEvent()},CalculatePriceProductItem:function(t){var e=parseInt(t.find(".quantity").val()),r=parseInt(t.find(".price-new").data("sale-price")),a="#item-promotion-"+t.data("id"),o=0;$(a).find(".choose-promotion").each(function(t){this.checked&&1==$(this).data("is-discount-price")&&(o+=parseInt($(this).data("value")))});var n=r*e-o;t.find(".item-sum").text(R.FormatNumber(n)),t.find(".item-sum").data("item-sum",n),R.Order.CalculateTotalOrders(),R.Order.RegisterEvent()},CalculateTotalOrders:function(){var t=0;$(".item").each(function(e){$(this).find(".choosen-item").is(":checked")&&(t+=parseInt($(this).find(".item-sum").data("item-sum")))});var e=0;$(".choose-promotion").each(function(t){this.checked&&1==$(this).data("is-discount-price")&&(console.log("is Checked  in function"),e+=parseInt($(this).data("value")))});var r=t;$("#order-sum").text(R.FormatNumber(t)),$("#order-sum").data("price",t),$("#order-discount").text(R.FormatNumber(e)),$("#order-discount").data("price",e),$("#order-price").text(R.FormatNumber(r)),$("#order-price").data("price",r),R.Order.RegisterEvent()},RenderModalConfirmOrder:function(t,e,r){return $.post("/Order/GetOrderCode",null,function(a){var o="";a<10&&(o="00"+a),a<100&&a>10&&(o="0"+a),a>100&&(o=a);var n="JHN-"+o;event.preventDefault();var i=$("#modal-don-hang");i.find(".table-report-item-append").each(function(t){$(this).remove()}),i.find(".customer-name").text(t.Name),i.find(".customer-phone").text(t.PhoneNumber),i.find(".customer-address").text(t.Address);var c="";e.forEach(function(t){c+="<li>"+t+"</li>"}),i.find(".list_extra_infomation").empty().append(c),r.forEach(function(t){$(".table-report-item").last().clone().insertAfter(".table-report-item:last");var e=$(".table-report-item").last();e.find(".product-id").text(t.ProductId),e.find(".product-name").text(t.Name),e.find(".product-quantity").text(t.Quantity),e.find(".product-price").text(R.FormatNumber(t.LogPrice)),e.find(".product-total-price").text(R.FormatNumber(t.LogPrice*t.Quantity));var r="";t.Promotions.forEach(function(t){r+="<li>"+t.LogName+"</li>"}),e.find(".product-promotion-ul").empty().append(r),e.css("display","table-row"),e.addClass("table-report-item-append")}),i.find(".total-payment").html(R.FormatNumber($("#order-price").data("price"))+"vnd"),$("#modal-don-hang").modal("show"),$(".order-code").text(n);var d=moment(new Date).format("DD - MM - YYYY");$(".order-time").text(d);var s=[];r.forEach(function(t){s.push(t.ProductId)});var l=$("#modal-don-hang").find(".modal-content").html();i.find(".btn-save").off("click").on("click",function(){var a={OrderCode:n,Customer:t,Products:r,Extras:e},o=R.Order.culture+"/Order/CreateOrder";$.post(o,a,function(t){s.forEach(function(t){R.RemoveCartItem(t)}),R.LoadCart(),$("#modal-don-hang").modal("hide"),$("#modal-xn").modal("show"),R.Order.SendMail("order",l)})})}),!1},PickingProvince:function(t,e){var r="."+t.replace("_","-"),a={locationType:t,parent:e};$.post("/Order/GetQuanHuyen",a,function(t){var e=JSON.parse(t);console.log(e),console.log(r),$(r).prop("disabled",!1);var a="";e.forEach(function(t){a+='<option value="'+t.Key+'">'+t.Value.name_with_type+"</option>"}),$(r).html("").html(a)})},GenOrderCode:function(t){},SendMail:function(t,e){var r={type:t,body:e},a=R.Order.culture+"/Extra/SendMail";$.post(a,r,function(t){console.log(t)})}},$(function(){R.Order.Init()});