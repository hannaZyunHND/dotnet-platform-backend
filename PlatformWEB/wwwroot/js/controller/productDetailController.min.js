function flyToElement(t,o){$(this);var e=$(t).clone();$(e).css({position:"absolute",top:$(t).offset().top+"px",left:$(t).offset().left+"px",opacity:1,"z-index":1e3}).appendTo($("body"));var a=$(o).offset().left,i=$(o).offset().top;$(e).animate({opacity:.4,left:a,top:i,width:$(o).width(),height:$(o).height()},700,function(){$(o).effect("shake",function(){$(e).fadeOut("fast",function(){$(e).remove()})})})}R.ProductDetail={Init:function(){R.ProductDetail.RegisterEvent(),R.ProductDetail.culture=R.Culture(),R.ProductDetail.CountDownFlashSale(".timer"),R.ProductDetail.AddLastSeenProduct(),R.ProductDetail.AddViewCountProduct(),R.ProductDetail.current_location=R.CurrentLocationId(),R.ProductDetail.GetDeptByLocationId(R.CurrentLocationId())},RegisterEvent:function(){$("#modal-showromm-ganhat").off("submit").on("submit",function(){var t=window.location.href,o=$("#txt-name-bh-1").val(),e=$("#txt-phone-bh-1").val(),a=$("._picking_address").text(),i=$("#txt-time-input").val(),n="link: "+t;n+="Thời gian: "+i;var c={Name:o,Phone:e,Address:"",Title:"Kiểm tra siêu thị có hàng trưng bày",Content:n+="Địa điểm: "+a,Type:2,Source:"web",BookingTime:moment(i,"DD/MM/YYYY").format("YYYY-MM-DD")};return console.log(c),R.ProductDetail.BookingProductDetail(c),!1}),$("._choosen").off("change").on("change",function(){var t=$("input[name='department']:checked").parent("label").text();console.log(t),$("._picking_address").text("").text(t)}),$(".find-showroom").off("click").on("click",function(){$("#modal-showromm-ganhat").modal("show"),R.ProductDetail.GetDeptByLocationId(R.CurrentLocationId())}),$(".location-item").off("click").on("click",function(){var t=$(this).text();$(this).closest(".select-local").find(".dropdown-toggle").text(t);var o=$(this).data("price"),e=$(this).data("sale-price");$(this).data("unit");console.log(o,e),$("#price-sale").text(R.FormatNumber(e)+" đ/"),$("#default_price").text(R.FormatNumber(e)+" đ/"),$("#default-sale-price").data("sale-price",e),$("#price-normal").text(R.FormatNumber(o)+"đ"),0==o&&$("#price-normal").hide();var a=$(this).data("product-id"),i=$(this).data("location-id");R.ProductDetail.GetComboInProduct(a,i)}),$(".choose_combo").change(function(){R.ProductDetail.InfomationCombo()}),$("#plus").off("click").on("click",function(){console.log("plus");var t=parseInt($("#quantity").val())+1;$("#quantity").val(t)}),$("#minus").off("click").on("click",function(){console.log("minus");var t=parseInt($("#quantity").val())-1;t<=1&&(t=1),$("#quantity").val(t)}),$("#add-to-cart").off("click").on("click",function(){var t=$(this).closest(".product-detail").find("#list_combo").find(".image-product"),o=$(".dropdown-cart-trigger");t.length>0&&flyToElement(t[0],$(o)),R.ProductDetail.AddToCart()}),$("#buy-now").off("click").on("click",function(){R.ProductDetail.AddToCart()}),$("#add-cart-combo").off("click").on("click",function(){R.ProductDetail.AddToCartCombo()}),$("#rating-form").off("submit").on("submit",function(){var t=$(this).data("type"),o=$(this).data("object-id"),e=$(this).data("object-type"),a=$(this).find(".txt_name").val(),i=$(this).find(".txt_phoneOrEmail").val(),n=$(this).find(".input-choose-file").data("target-url"),c=$(this).find(".txt_content").val(),r=0;$(this).find(".star-rating-dynamic").find(".checked").each(function(t){r++});var l=$(this).find(".input-choose-file").get(0).files,d={objectId:o,objectType:e,name:a,phoneOrEmail:i,avatar:n,content:c,type:t,rate:r};return R.ProductDetail.CreateComment(l,d),!1}),$("#picking-estimates").off("click").on("click",function(){var t=$(this).data("id"),o=$(this).data("material"),e=(parseInt($("#quantity").val()),$(this).data("price")),a=$(this).data("sale-price"),i=$(this).data("avatar"),n=$(this).data("spec-name"),c=$(this).data("spec-value"),r={Id:t,Title:$(this).data("title"),SalePrice:a,Price:e,MaterialType:o,Avatar:i,SpecName:n,SpecValue:c};R.ProductDetail.AddEstimatesLocal(r)}),$(".star-rating-dynamic i ").off("click").on("click",function(){$(this).parent().find(".star-rating-dynamic i").removeClass("checked"),$(this).addClass("checked"),$(this).prevAll().addClass("checked"),$(this).nextAll().removeClass("checked")}),$(".department-location").off("change").on("change",function(){console.log(1);var t=$(this).val();R.ProductDetail.GetDeptByLocationId(t)})},BookingProductDetail:function(t){$.post("/Extra/CreateServiceTicketWBookingTime",t,function(t){return console.log(t),$("#modal-xn").modal("show"),R.ProductDetail.CloseModalAndClearText(),!1})},InfomationCombo:function(){var t=0,o=0;$(".choose_combo").each(function(e){this.checked&&(t++,o+=parseInt($(this).data("sale-price")))}),$("#count_combo").text(t),$("#total_combo_price").text(R.FormatNumber(o)+"đ"),R.ProductDetail.RegisterEvent()},GetComboInProduct:function(t,o){var e={product_id:t,location_id:o};$.post(R.ProductDetail.culture+"/Product/GetComboByLocationId",e,function(t){$("#_binding_combo").html(t),R.ProductDetail.InfomationCombo(),R.ProductDetail.RegisterEvent()})},AddToCart:function(){var t=$("#add-to-cart").data("product-id"),o=$("#quantity").val(),e=[];$(".choose_promotion").each(function(t){var o=$(this).data("promotion-id"),a=!1;this.checked&&(a=!0);var i={id:o,checked:a};e.push(i)});var a={product_id:t,quantity:parseInt(o),add_time:Date.parse(new Date),promotion:e},i=JSON.parse(localStorage.getItem("arrProduct"));i.push(a),localStorage.setItem("arrProduct",JSON.stringify(i)),R.LoadCart()},AddToCartCombo:function(){console.log(1);var t=JSON.parse(localStorage.getItem("arrProduct"));$(".choose_combo").each(function(o){if(this.checked){var e={product_id:$(this).data("product-id"),quantity:1,add_time:Date.parse(new Date),promotion:[]};t.push(e)}}),localStorage.setItem("arrProduct",JSON.stringify(t)),R.LoadCart()},CreateComment:function(t,o){var e=R.ProductDetail.culture+"/Extra/CreateComment";$.post(e,o,function(t){return $("#modal-xn").modal("show"),R.ProductDetail.CloseModalAndClearText(),!1})},CloseModalAndClearText:function(){$(".txt_name").val(""),$(".txt_phoneOrEmail").val(""),$(".txt_content").val(""),$("#modal-danh-gia").modal("hide"),$("#txt-name-bh-1").val(""),$("#txt-phone-bh-1").val(""),$("._picking_address").text(""),$("#modal-showromm-ganhat").modal("hide")},AddLastSeenProduct:function(){var t=$(".product-detail").data("id"),o=[],e=localStorage.getItem("lastSeen");if(null==e&&(o.push(t),localStorage.setItem("lastSeen",JSON.stringify(o))),null!=e){o=JSON.parse(e);for(var a=0,i=0;i<o.length;i++)o[i]==t&&(a=i);a>0&&(o.splice(a,1),o.unshift(t)),a<=0&&(o.splice(a,1),o.unshift(t)),localStorage.setItem("lastSeen",JSON.stringify(o))}},AddViewCountProduct:function(){var t={objectId:$(".product-detail").data("id"),type:"product"};$.post("/Extra/CreateViewCount",t,function(t){console.log(t)})},AddEstimatesLocal:function(t){var o=localStorage.getItem("arrEstimates");if(null==o){(e=[]).push(t),localStorage.setItem("arrEstimates",JSON.stringify(e));n="/du-toan-cong-trinh";window.location.href=n}if(null!=o){for(var e=JSON.parse(o),a=!1,i=0;i<e.length;i++)e[i].MaterialType==t.MaterialType&&(e.splice(i,1),e.push(t),a=!0);0==a&&e.push(t),localStorage.setItem("arrEstimates",JSON.stringify(e));var n="/du-toan-cong-trinh";window.location.href=n}},CountDownFlashSale:function(t){var o=$(t).data("end-time");R.CountDown(o,t)},GetCurrentLocation:function(){var t=R.ProductDetail.current_location;$(".department-location").val(t)},GetDeptByLocationId:function(t){var o="/Store/ListDeptByLocId?id="+t;$.get(o,function(o){$(".department-location").val(t),console.log(o),$("#modal-showromm-ganhat").find(".cust-bg-mdal").html("").html(o),R.ProductDetail.RegisterEvent()})}},$(function(){R.ProductDetail.Init()});